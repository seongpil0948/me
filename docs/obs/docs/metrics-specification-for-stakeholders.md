# 데이터 플랫폼 지표 명세서

**작성일**: 2025-10-30  
**목적**: 기획/마케팅 팀과의 지표 정의 협의  
**대상 서비스**: 더샵 브랜드, 더샵 약국, 더샵 병원

---

## 📋 목차

1. [사용자 행동 분석 지표](#1-사용자-행동-분석-지표)
2. [커머스 분석 지표](#2-커머스-분석-지표)
3. [데이터 품질 기준](#3-데이터-품질-기준)
4. [협의 필요 사항](#4-협의-필요-사항)

---

## 1. 사용자 행동 분석 지표

### 1.1 MAU (Monthly Active Users) - 월간 활성 사용자

**데이터 소스**: `commerce.session.start` 이벤트  
**집계 기준**: 월별

#### 계산 방식

```
MAU = 해당 월에 세션을 시작한 고유 사용자 수
```

#### 포함 지표

| 지표명                   | 설명                | 계산식                    |
| ------------------------ | ------------------- | ------------------------- |
| **monthly_active_users** | 월간 활성 사용자 수 | COUNT(DISTINCT userKey)   |
| **total_sessions**       | 총 세션 수          | COUNT(DISTINCT sessionId) |
| **total_events**         | 총 이벤트 수        | COUNT(\*)                 |

#### 비즈니스 의미

- 서비스의 월별 사용자 규모 추적
- 서비스 성장세 파악
- 마케팅 캠페인 효과 측정

---

### 1.2 DAU (Daily Active Users) - 일간 활성 사용자

**데이터 소스**: `commerce.session.start` 이벤트  
**집계 기준**: 일별 (최근 90일)

#### 계산 방식

```
DAU = 해당 날짜에 세션을 시작한 고유 사용자 수
```

#### 포함 지표

| 지표명                 | 설명                | 계산식                     |
| ---------------------- | ------------------- | -------------------------- |
| **daily_active_users** | 일간 활성 사용자 수 | COUNT(DISTINCT userKey)    |
| **daily_sessions**     | 일간 세션 수        | COUNT(DISTINCT sessionId)  |
| **daily_events**       | 일간 이벤트 수      | COUNT(\*)                  |
| **events_per_user**    | 사용자당 이벤트 수  | 총 이벤트 / 고유 사용자 수 |

#### 비즈니스 의미

- 일별 서비스 활성도 모니터링
- 요일별/계절별 트렌드 파악
- 급격한 사용자 증감 탐지

---

### 1.3 Retention (재방문율)

**데이터 소스**: `commerce.session.start` 이벤트  
**집계 기준**: D+1, D+7, D+30

#### 계산 방식

```
D+1 재방문율 = (기준일 사용자 중 다음날 재방문한 사용자 수) / (기준일 총 사용자 수) × 100

예시:
- 2025-10-26에 방문한 사용자: 1,000명 (base_users)
- 그 중 2025-10-27에도 방문한 사용자: 300명 (retained_users)
- D+1 재방문율 = (300 / 1,000) × 100 = 30%
```

#### 포함 지표

| 지표명             | 설명             | 계산식                                |
| ------------------ | ---------------- | ------------------------------------- |
| **retention_type** | 재방문 유형      | D+1, D+7, D+30                        |
| **base_users**     | 기준일 사용자 수 | 기준일의 고유 사용자 수               |
| **retained_users** | 재방문 사용자 수 | 기준일과 비교일 모두 방문한 사용자 수 |
| **retention_rate** | 재방문율 (%)     | (retained_users / base_users) × 100   |

#### 재방문 기간 정의

- **D+1**: 익일 재방문 (단기 충성도)
- **D+7**: 7일 후 재방문 (중기 충성도)
- **D+30**: 30일 후 재방문 (장기 충성도)

#### 비즈니스 의미

- 사용자 충성도 측정
- 서비스 만족도 간접 지표
- 이탈률 역산 가능 (100% - 재방문율)

---

### 1.4 Conversion (전환율)

**데이터 소스**: `commerce.session.start`, `commerce.product.view`, `commerce.cart.add`  
**집계 기준**: 일별 (최근 90일)

#### 계산 방식

```
상품 조회율 = (상품 조회 세션 수 / 전체 세션 수) × 100
장바구니 전환율 = (장바구니 추가 세션 수 / 상품 조회 세션 수) × 100
전체 전환율 = (장바구니 추가 세션 수 / 전체 세션 수) × 100
사용자 전환율 = (구매 사용자 수 / 전체 사용자 수) × 100
```

#### 포함 지표

| 지표명                      | 설명                  | 계산식                                                 |
| --------------------------- | --------------------- | ------------------------------------------------------ |
| **total_sessions**          | 전체 세션 수          | COUNT(DISTINCT sessionId) WHERE body = 'session.start' |
| **product_view_sessions**   | 상품 조회 세션 수     | COUNT(DISTINCT sessionId) WHERE body = 'product.view'  |
| **cart_add_sessions**       | 장바구니 추가 세션 수 | COUNT(DISTINCT sessionId) WHERE body = 'cart.add'      |
| **total_users**             | 전체 사용자 수        | COUNT(DISTINCT userKey)                                |
| **purchasing_users**        | 구매 사용자 수        | COUNT(DISTINCT userKey) WHERE body = 'cart.add'        |
| **product_view_rate**       | 상품 조회율 (%)       | (product_view_sessions / total_sessions) × 100         |
| **cart_conversion_rate**    | 장바구니 전환율 (%)   | (cart_add_sessions / product_view_sessions) × 100      |
| **overall_conversion_rate** | 전체 전환율 (%)       | (cart_add_sessions / total_sessions) × 100             |
| **user_conversion_rate**    | 사용자 전환율 (%)     | (purchasing_users / total_users) × 100                 |

#### 전환 퍼널

```
세션 시작 (100%)
    ↓
상품 조회 (product_view_rate%)
    ↓
장바구니 추가 (cart_conversion_rate%)
```

#### 비즈니스 의미

- 구매 퍼널 단계별 이탈률 파악
- UI/UX 개선 포인트 식별
- A/B 테스트 효과 측정

---

### 1.5 User Cohort (사용자 코호트)

**데이터 소스**: `commerce.session.start` 이벤트  
**집계 기준**: 최초 방문일 기준

#### 계산 방식

```
최초 방문일로부터 경과 시간에 따라 사용자 분류
```

#### 코호트 분류

| 코호트 유형         | 조건                   | 설명             |
| ------------------- | ---------------------- | ---------------- |
| **New (0-7d)**      | 최초 방문 후 0~7일     | 신규 사용자      |
| **Recent (8-30d)**  | 최초 방문 후 8~30일    | 최근 유입 사용자 |
| **Active (31-90d)** | 최초 방문 후 31~90일   | 활성 사용자      |
| **Veteran (90d+)**  | 최초 방문 후 90일 초과 | 장기 사용자      |

#### 포함 지표

| 지표명          | 설명                    |
| --------------- | ----------------------- |
| **cohort_type** | 코호트 유형             |
| **user_count**  | 해당 코호트의 사용자 수 |

#### 비즈니스 의미

- 사용자 생애 주기 분석
- 코호트별 맞춤 마케팅 전략 수립
- 신규 사용자 온보딩 효과 측정

---

### 1.6 Session Metrics (세션 지표)

**데이터 소스**: 전체 OTEL 로그  
**집계 기준**: 일별 (최근 90일)

#### 계산 방식

```
세션당 이벤트 수 = 세션별 총 이벤트 수 집계 후 평균
세션당 이벤트 유형 수 = 세션별 고유 이벤트 타입 수 집계 후 평균
```

#### 포함 지표

| 지표명                          | 설명                       | 계산식                                   |
| ------------------------------- | -------------------------- | ---------------------------------------- |
| **total_sessions**              | 전체 세션 수               | COUNT(DISTINCT sessionId)                |
| **avg_events_per_session**      | 세션당 평균 이벤트 수      | AVG(세션별 이벤트 수)                    |
| **avg_event_types_per_session** | 세션당 평균 이벤트 유형 수 | AVG(세션별 고유 이벤트 타입 수)          |
| **max_events_per_session**      | 세션당 최대 이벤트 수      | MAX(세션별 이벤트 수)                    |
| **median_events_per_session**   | 세션당 이벤트 수 중앙값    | APPROX_PERCENTILE(세션별 이벤트 수, 0.5) |
| **p90_events_per_session**      | 세션당 이벤트 수 90분위수  | APPROX_PERCENTILE(세션별 이벤트 수, 0.9) |

#### 비즈니스 의미

- 사용자 참여도(Engagement) 측정
- 세션 품질 평가
- 비정상 패턴 탐지 (봇, 크롤러 등)

---

### 1.7 Event Distribution (이벤트 분포)

**데이터 소스**: 전체 OTEL 로그  
**집계 기준**: 최근 7일간 이벤트 타입별

#### 계산 방식

```
이벤트 비율 = (특정 이벤트 수 / 전체 이벤트 수) × 100
```

#### 포함 지표

| 지표명                  | 설명                            | 계산식                               |
| ----------------------- | ------------------------------- | ------------------------------------ |
| **event_type**          | 이벤트 타입                     | body 값 (예: commerce.cart.add)      |
| **event_count**         | 이벤트 발생 횟수                | COUNT(\*)                            |
| **unique_users**        | 해당 이벤트 발생 고유 사용자 수 | COUNT(DISTINCT userKey)              |
| **unique_sessions**     | 해당 이벤트 발생 고유 세션 수   | COUNT(DISTINCT sessionId)            |
| **percentage_of_total** | 전체 대비 비율 (%)              | (event_count / 전체 이벤트 수) × 100 |

#### 비즈니스 의미

- 주요 사용자 액션 파악
- 기능별 사용 빈도 분석
- 미사용 기능 식별

---

## 2. 커머스 분석 지표

### 📌 중요: 분석 기간 정의

모든 커머스 지표는 **두 가지 기간**으로 제공됩니다:

- **1M (1개월)**: 최근 1개월 데이터
- **3M (3개월)**: 최근 3개월 데이터

각 지표는 별도 테이블로 관리되며, `period` 필드로 구분됩니다.

---

### 2.1 Button Interaction (버튼 클릭 분석)

**데이터 소스**: `commerce.button.click` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
버튼별 클릭 수, 고유 사용자 수, 세션 수 집계
사용자당 평균 클릭 수 = 총 클릭 수 / 고유 사용자 수
```

#### 포함 지표

| 지표명                  | 설명                  | 예시 값                            |
| ----------------------- | --------------------- | ---------------------------------- |
| **action**              | 버튼 액션 타입        | "add_to_cart", "buy_now"           |
| **menuName**            | 메뉴 이름             | "상품 상세", "카테고리"            |
| **page**                | 페이지 정보           | "/product/123", "/category/health" |
| **total_clicks**        | 총 클릭 수            | 15,234                             |
| **unique_users**        | 클릭한 고유 사용자 수 | 3,421                              |
| **unique_sessions**     | 클릭이 발생한 세션 수 | 4,567                              |
| **avg_clicks_per_user** | 사용자당 평균 클릭 수 | 4.45                               |

#### 비즈니스 의미

- 주요 CTA(Call-to-Action) 버튼 성과 측정
- 페이지별 사용자 행동 패턴 분석
- UI/UX 최적화 우선순위 결정

**상위 50개 버튼만 집계** (클릭 수 기준)

---

### 2.2 Product Ranking (상품 순위)

**데이터 소스**: `commerce.cart.add` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
상품별 장바구니 추가 횟수, 구매 금액, 수량 집계
평균 판매가 = SUM(판매가 × 수량) / SUM(수량)
총 장바구니 가치 = SUM(수량 × 판매가)
```

#### 포함 지표

| 지표명                | 설명                    | 예시 값                                     |
| --------------------- | ----------------------- | ------------------------------------------- |
| **productName**       | 상품명                  | "비타민D 1000IU"                            |
| **category**          | 카테고리                | "건강기능식품"                              |
| **sellerNm**          | 판매자명                | "건강약국"                                  |
| **source**            | 장바구니 추가 경로      | "favorites", "routine", "missed", "unknown" |
| **cart_add_count**    | 장바구니 추가 횟수      | 1,234                                       |
| **unique_users**      | 구매한 고유 사용자 수   | 456                                         |
| **unique_sessions**   | 구매 세션 수            | 567                                         |
| **total_quantity**    | 총 수량                 | 2,345                                       |
| **avg_sale_price**    | 평균 판매가 (원)        | 25,000                                      |
| **total_cart_value**  | 총 장바구니 가치 (원)   | 58,625,000                                  |
| **avg_adds_per_user** | 사용자당 평균 추가 횟수 | 2.71                                        |

#### 🆕 장바구니 추가 경로 (source)

| 경로          | 설명                                    |
| ------------- | --------------------------------------- |
| **favorites** | 찜 목록에서 추가                        |
| **routine**   | 루틴 목록에서 추가                      |
| **missed**    | 놓친 상품 목록에서 추가                 |
| **unknown**   | 기타 경로 (직접 검색, 카테고리 탐색 등) |

#### 비즈니스 의미

- 인기 상품 파악
- 재고 관리 우선순위
- 카테고리별 매출 기여도
- 장바구니 추가 경로별 효율성 분석
- 찜/루틴 기능의 전환 효과 측정

**상위 100개 상품만 집계** (장바구니 추가 횟수 기준)

---

### 2.3 Search Analytics (검색 분석)

**데이터 소스**: `commerce.search`, `commerce.search.result_click` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
검색어별 검색 횟수와 결과 클릭 횟수 집계
클릭률 = (결과 클릭 세션 수 / 검색 세션 수) × 100
```

#### 포함 지표

| 지표명                 | 설명                | 예시 값            |
| ---------------------- | ------------------- | ------------------ |
| **searchQuery**        | 검색어              | "비타민", "감기약" |
| **search_count**       | 검색 횟수           | 1,567              |
| **click_count**        | 검색 결과 클릭 횟수 | 1,234              |
| **click_through_rate** | 클릭률 (%)          | 78.71              |

#### 비즈니스 의미

- 사용자 니즈 파악
- 검색 결과 품질 평가
- 무응답 검색어 개선
- 상품 큐레이션 개선

#### 주요 분석 포인트

- **높은 검색 빈도 + 낮은 클릭률**: 검색 결과 개선 필요
- **높은 검색 빈도 + 높은 클릭률**: 주력 상품 카테고리
- **낮은 검색 빈도**: 틈새 상품 기회 또는 불필요한 상품

**상위 200개 검색어만 집계** (검색 횟수 기준)

---

### 2.4 Category Performance (카테고리 성과)

**데이터 소스**: `commerce.cart.add` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
카테고리별 장바구니 추가 횟수, 상품 수, 금액 집계
평균 가격 = AVG(판매가)
총 가치 = SUM(수량 × 판매가)
```

#### 포함 지표

| 지표명              | 설명               | 예시 값                      |
| ------------------- | ------------------ | ---------------------------- |
| **category**        | 카테고리명         | "건강기능식품", "일반의약품" |
| **cart_add_count**  | 장바구니 추가 횟수 | 5,678                        |
| **unique_users**    | 고유 사용자 수     | 2,345                        |
| **unique_products** | 고유 상품 수       | 123                          |
| **total_quantity**  | 총 수량            | 8,901                        |
| **avg_price**       | 평균 가격 (원)     | 32,500                       |
| **total_value**     | 총 가치 (원)       | 289,282,500                  |

#### 비즈니스 의미

- 카테고리별 매출 기여도 파악
- 상품 구성 전략 수립
- 프로모션 우선순위 결정

**상위 30개 카테고리만 집계** (장바구니 추가 횟수 기준)

---

### 2.5 Hourly Traffic (시간대별 트래픽)

**데이터 소스**: `commerce.session.start`, `commerce.cart.add` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
시간대(0~23시)별 세션 수, 사용자 수, 장바구니 추가 수 집계
장바구니 전환율 = (장바구니 추가 수 / 세션 수) × 100
```

#### 포함 지표

| 지표명                   | 설명                      | 예시 값       |
| ------------------------ | ------------------------- | ------------- |
| **hour**                 | 시간대 (0~23)             | 14 (오후 2시) |
| **sessions**             | 세션 수                   | 1,234         |
| **unique_users**         | 고유 사용자 수            | 987           |
| **cart_adds**            | 장바구니 추가 횟수        | 456           |
| **cart_users**           | 장바구니 추가한 사용자 수 | 321           |
| **cart_conversion_rate** | 장바구니 전환율 (%)       | 36.96         |

#### 비즈니스 의미

- 피크 타임 파악
- 마케팅 캠페인 최적 시간 선정
- 서버 리소스 배분 계획
- 고객 서비스 인력 배치

#### 활용 예시

- **오전 10시 ~ 12시 트래픽 높음**: 모닝 세일 진행
- **저녁 8시 ~ 10시 전환율 높음**: 주요 프로모션 노출
- **새벽 2시 ~ 6시 트래픽 낮음**: 시스템 점검 시간

---

### 2.6 Purchase Analytics (구매 분석)

**데이터 소스**: `commerce.checkout.purchase` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
일별 구매 건수, 구매 사용자 수 집계
사용자당 구매 횟수 = 총 구매 건수 / 고유 구매자 수
```

#### 포함 지표

| 지표명                 | 설명                | 예시 값    | 비고           |
| ---------------------- | ------------------- | ---------- | -------------- |
| **purchase_date**      | 구매 날짜           | 2025-10-30 | -              |
| **total_purchases**    | 총 구매 건수        | 234        | -              |
| **unique_purchasers**  | 고유 구매자 수      | 189        | -              |
| **unique_sessions**    | 구매 세션 수        | 198        | -              |
| **total_revenue**      | 총 매출액 (원)      | NULL       | ⚠️ 현재 미수집 |
| **avg_order_value**    | 평균 주문 금액 (원) | NULL       | ⚠️ 현재 미수집 |
| **purchases_per_user** | 사용자당 구매 횟수  | 1.24       | -              |

#### ⚠️ 데이터 제한사항

- **매출액 데이터 미수집**: 현재 `commerce.checkout.purchase` 이벤트에 금액 정보 없음
- **대안**: `commerce.cart.add` 이벤트의 `total_cart_value`를 참고 지표로 활용 가능

#### 비즈니스 의미

- 일별 매출 추이 파악
- 재구매율 분석 (purchases_per_user > 1인 비율)
- 구매 전환 패턴 분석

---

### 2.7 Navigation Flow (페이지 이동 경로)

**데이터 소스**: `Routing in client side` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
페이지(path)별 페이지뷰 수, 사용자 수, 세션 수 집계
세션당 평균 조회 수 = 페이지뷰 수 / 세션 수
```

#### 포함 지표

| 지표명                    | 설명                  | 예시 값                            |
| ------------------------- | --------------------- | ---------------------------------- |
| **path**                  | 페이지 경로           | "/product/123", "/category/health" |
| **page_view_count**       | 페이지뷰 수           | 5,678                              |
| **unique_users**          | 조회한 고유 사용자 수 | 2,345                              |
| **unique_sessions**       | 조회가 발생한 세션 수 | 3,012                              |
| **avg_views_per_session** | 세션당 평균 조회 수   | 1.89                               |

#### 비즈니스 의미

- 주요 유입 페이지 파악
- 이탈률 높은 페이지 식별
- 사용자 여정(User Journey) 분석
- 랜딩 페이지 최적화

**상위 100개 경로만 집계** (페이지뷰 수 기준)

---

### 2.8 Cart Source Analytics (장바구니 추가 경로 분석) 🆕

**데이터 소스**: `commerce.cart.add` 이벤트  
**집계 기간**: 1M / 3M

#### 계산 방식

```
장바구니 추가 경로(source)별 추가 횟수, 사용자 수, 상품 수, 금액 집계
경로 비율 = (경로별 추가 횟수 / 전체 추가 횟수) × 100
사용자당 평균 추가 횟수 = 경로별 추가 횟수 / 경로별 고유 사용자 수
```

#### 포함 지표

| 지표명                | 설명                    | 예시 값                                     |
| --------------------- | ----------------------- | ------------------------------------------- |
| **source**            | 장바구니 추가 경로      | "favorites", "routine", "missed", "unknown" |
| **cart_add_count**    | 장바구니 추가 횟수      | 3,456                                       |
| **unique_users**      | 고유 사용자 수          | 1,234                                       |
| **unique_sessions**   | 고유 세션 수            | 1,567                                       |
| **unique_products**   | 고유 상품 수            | 234                                         |
| **total_quantity**    | 총 수량                 | 5,678                                       |
| **avg_price**         | 평균 가격 (원)          | 28,500                                      |
| **total_cart_value**  | 총 장바구니 가치 (원)   | 161,823,000                                 |
| **source_percentage** | 전체 대비 비율 (%)      | 35.67                                       |
| **avg_adds_per_user** | 사용자당 평균 추가 횟수 | 2.80                                        |

#### 장바구니 추가 경로 정의

| 경로          | 설명                    | 기대 효과             |
| ------------- | ----------------------- | --------------------- |
| **favorites** | 찜 목록에서 추가        | 관심 상품 전환율 측정 |
| **routine**   | 루틴 목록에서 추가      | 정기 구매 패턴 파악   |
| **missed**    | 놓친 상품 목록에서 추가 | 재고 알림 효과 측정   |
| **unknown**   | 기타 경로               | 일반 쇼핑 행동        |

#### 비즈니스 의미

- **찜/루틴 기능의 실질적 전환 효과** 측정
- **고객 세그먼트별 구매 패턴** 파악
  - favorites 높음: 계획적 구매 성향
  - routine 높음: 충성도 높은 정기 구매 고객
  - missed 높음: 재고 알림 효과 높음
- **기능별 ROI 분석**: 개발 리소스 투자 우선순위 결정
- **개인화 전략 수립**: 경로별 사용자 특성에 맞는 마케팅

#### 활용 예시

```
예시 데이터:
- favorites: 40% (1,500명, 평균 3.2회/인)
- routine: 25% (800명, 평균 4.5회/인)
- missed: 15% (600명, 평균 2.1회/인)
- unknown: 20% (2,000명, 평균 1.5회/인)

인사이트:
→ routine 사용자의 재구매율이 가장 높음 (4.5회/인)
→ favorites 기능이 가장 많이 사용됨 (전체의 40%)
→ 루틴 기능 활성화에 집중하여 LTV 증대 전략 수립
```

---

## 3. 데이터 품질 기준

### 3.1 데이터 수집 기간

| 분석 유형            | 최소 유효 날짜 | 사유                    |
| -------------------- | -------------- | ----------------------- |
| **사용자 행동 분석** | 2025-09-20     | 이전 데이터 손상        |
| **커머스 분석**      | 2025-10-01     | 커머스 로그 수집 시작일 |

### 3.2 데이터 필터링 규칙

```sql
-- 사용자 행동 분석
WHERE CAST(year || '-' || month || '-' || day AS DATE) >= DATE '2025-09-20'
    AND attributes.userKey IS NOT NULL
    AND attributes."resource.service.name" IN ('theshop-brand', 'theshop-pharmacy', 'theshop-hospital')

-- 커머스 분석 (1개월)
WHERE (year = '2025' AND month IN ('10', '09'))  -- 월 단위 필터링
    AND attributes."resource.service.name" IN ('theshop-brand', 'theshop-pharmacy', 'theshop-hospital')
```

### 3.3 NULL 처리 기준

| 필드          | NULL 처리 방식         | 예시                                  |
| ------------- | ---------------------- | ------------------------------------- |
| **userKey**   | 제외 (필수 필드)       | `AND userKey IS NOT NULL`             |
| **sessionId** | 제외 (필수 필드)       | `AND sessionId IS NOT NULL`           |
| **category**  | 'Uncategorized'로 대체 | `COALESCE(category, 'Uncategorized')` |
| **source**    | 'unknown'으로 대체     | `COALESCE(source, 'unknown')`         |
| **salePrice** | price 필드로 폴백      | `COALESCE(salePrice, price)`          |

### 3.4 데이터 정합성

- **0으로 나누기 방지**: `NULLIF(denominator, 0)` 사용
- **타입 변환 안전성**: `TRY_CAST()` 사용으로 변환 실패 시 NULL 반환
- **백분율 소수점**: 소수점 둘째 자리까지 (`ROUND(value, 2)`)

---

## 4. 협의 필요 사항

### 4.1 지표 정의 검증

다음 지표들의 비즈니스 정의가 현재 계산식과 일치하는지 확인 필요:

#### 🔍 재방문율 (Retention)

**현재 정의**:

```
D+1 재방문율 = (기준일 사용자 중 다음날 재방문한 사용자) / (기준일 사용자 수)
```

**질문**:

- D+7, D+30은 "정확히 7일/30일 후"인가, "7일/30일 이내"인가?
- 현재는 "정확히 해당 일자"로 계산 중

#### 🔍 전환율 (Conversion)

**현재 정의**:

```
장바구니 전환율 = (장바구니 추가 세션 수) / (상품 조회 세션 수)
```

**질문**:

- 실제 "구매 완료"를 전환으로 봐야 하는가?
- 장바구니 추가를 전환으로 보는 것이 타당한가?
- `commerce.checkout.purchase` 이벤트 기반으로 변경 필요한가?

#### 🔍 사용자 코호트 기간

**현재 분류**:

- New: 0~7일
- Recent: 8~30일
- Active: 31~90일
- Veteran: 90일+

**질문**:

- 기간 구분이 비즈니스 정책과 일치하는가?
- 다른 구분 기준이 필요한가? (예: 0-14일, 15-30일, 31-60일, 60일+)

---

### 4.2 누락된 지표

현재 수집되지 않거나 계산되지 않는 지표:

#### 💰 매출 관련 지표

**현재 상태**: `commerce.checkout.purchase` 이벤트에 금액 정보 없음

**필요한 지표**:

- 일별/월별 총 매출액
- 평균 주문 금액 (AOV - Average Order Value)
- 고객 생애 가치 (LTV - Lifetime Value)
- 객단가 추이

**수집 필요 데이터**:

```json
{
  "body": "commerce.checkout.purchase",
  "attributes": {
    "orderAmount": 50000, // 주문 금액 (필요)
    "discountAmount": 5000, // 할인 금액
    "finalAmount": 45000, // 최종 결제 금액
    "paymentMethod": "card" // 결제 수단
  }
}
```

#### 🛒 장바구니 관련 지표

**현재 상태**: 장바구니 추가만 추적, 삭제/수정 미추적

**필요한 지표**:

- 장바구니 포기율 (Cart Abandonment Rate)
- 장바구니에서 구매까지 소요 시간
- 장바구니 내 평균 상품 수

**수집 필요 이벤트**:

- `commerce.cart.remove` (장바구니 삭제)
- `commerce.cart.update` (수량 변경)
- `commerce.cart.view` (장바구니 조회)

#### 📦 상품 상세 지표

**필요한 지표**:

- 상품 조회 → 장바구니 전환율 (상품별)
- 상품 페이지 체류 시간
- 상품 리뷰/평점 영향도

#### 🎯 마케팅 캠페인 추적

**필요한 데이터**:

- 유입 경로 (UTM 파라미터)
- 캠페인별 전환율
- 채널별 ROI

---

### 4.3 분석 기간 정책

현재 설정된 분석 기간이 비즈니스 요구사항과 일치하는지 확인:

| 지표               | 현재 기간      | 조정 필요 여부   |
| ------------------ | -------------- | ---------------- |
| MAU                | 전체 월 데이터 | -                |
| DAU                | 최근 90일      | -                |
| Retention          | D+1, D+7, D+30 | D+14, D+60 추가? |
| Conversion         | 최근 90일      | -                |
| User Cohort        | 최근 365일     | -                |
| Session Metrics    | 최근 90일      | -                |
| Event Distribution | 최근 7일       | 30일로 확대?     |
| 커머스 지표        | 1M / 3M        | 6M, 12M 추가?    |

---

### 4.4 대시보드 구성 우선순위

다음 지표들의 대시보드 노출 우선순위를 결정해 주세요:

#### 경영진 대시보드 (일일 체크)

1. DAU / MAU
2. 전환율 (Overall Conversion Rate)
3. 총 장바구니 가치 (Total Cart Value)
4. 인기 상품 TOP 10
5. **🆕 장바구니 추가 경로 분포** (찜/루틴/놓침/기타)

#### 마케팅 대시보드

1. User Cohort 분포
2. Retention Rate (D+1, D+7, D+30)
3. 시간대별 트래픽
4. 검색어 순위
5. **🆕 경로별 전환 효율** (source별 avg_adds_per_user)

#### 상품 기획 대시보드

1. 상품 순위 (Product Ranking)
2. 카테고리별 성과
3. 검색 클릭률 (CTR)
4. **🆕 찜/루틴 기능별 상위 상품** (source 필터)

#### 개발팀 모니터링

1. Event Distribution
2. Session Metrics
3. 버튼 클릭 분석
4. 페이지 이동 경로

---

### 4.5 알림 임계값 설정

비정상 상황 감지를 위한 알림 기준이 필요합니다:

| 지표            | 알림 조건 (예시)             | 우선순위  |
| --------------- | ---------------------------- | --------- |
| DAU             | 전일 대비 30% 이상 감소      | 🔴 High   |
| 전환율          | 주간 평균 대비 20% 이상 감소 | 🔴 High   |
| 장바구니 추가   | 시간당 50건 미만             | 🟡 Medium |
| 검색 클릭률     | 70% 미만                     | 🟡 Medium |
| Session Metrics | 세션당 이벤트 수 < 2         | 🟢 Low    |

---

### 4.6 개인정보 보호 정책

현재 수집 중인 개인 식별 정보 검토 필요:

**수집 중인 필드**:

- `userKey`: 사용자 고유 식별자
- `sessionId`: 세션 식별자

**질문**:

- 현재 `userKey`가 개인정보에 해당하는가? (이메일, 전화번호 등)
- 익명화/해싱 처리가 필요한가?
- 데이터 보관 기간 정책은? (GDPR, 개인정보보호법)

---

### 4.7 서비스별 차별화 지표

현재는 모든 서비스에 동일한 지표를 적용하고 있습니다:

| 서비스          | 특화 지표 필요 여부 | 예시                              |
| --------------- | ------------------- | --------------------------------- |
| **더샵 브랜드** | -                   | 브랜드별 선호도, 패키지 상품 분석 |
| **더샵 약국**   | -                   | 처방전 관련 이벤트, OTC 약품 순위 |
| **더샵 병원**   | -                   | 진료 예약 전환율, 진료과별 통계   |

---

## 📊 지표 요약표

### 사용자 행동 분석 지표 (7개)

| #   | 지표명             | 주기     | 주요 KPI                | 비즈니스 목표  |
| --- | ------------------ | -------- | ----------------------- | -------------- |
| 1   | MAU                | 월       | monthly_active_users    | 서비스 규모    |
| 2   | DAU                | 일       | daily_active_users      | 일일 활성도    |
| 3   | Retention          | D+1/7/30 | retention_rate          | 사용자 충성도  |
| 4   | Conversion         | 일       | overall_conversion_rate | 구매 전환 효율 |
| 5   | User Cohort        | -        | cohort별 user_count     | 생애주기 관리  |
| 6   | Session Metrics    | 일       | avg_events_per_session  | 참여도         |
| 7   | Event Distribution | 주       | 이벤트별 percentage     | 기능 사용률    |

### 커머스 분석 지표 (8개)

| #   | 지표명                       | 주기  | 주요 KPI                   | 비즈니스 목표              |
| --- | ---------------------------- | ----- | -------------------------- | -------------------------- |
| 1   | Button Interaction           | 1M/3M | total_clicks               | UI 효율성                  |
| 2   | Product Ranking              | 1M/3M | cart_add_count, **source** | 인기 상품, **경로별 효율** |
| 3   | Search Analytics             | 1M/3M | click_through_rate         | 검색 품질                  |
| 4   | Category Performance         | 1M/3M | total_value                | 카테고리 전략              |
| 5   | Hourly Traffic               | 1M/3M | cart_conversion_rate       | 시간대 최적화              |
| 6   | Purchase Analytics           | 1M/3M | total_purchases            | 매출 추이                  |
| 7   | Navigation Flow              | 1M/3M | page_view_count            | 사용자 여정                |
| 8   | 🆕 **Cart Source Analytics** | 1M/3M | **source_percentage**      | **찜/루틴 전환 효과**      |

**총 15개 지표** (사용자 행동 7개 + 커머스 8개)

---

## 🚀 다음 단계

### 1단계: 지표 정의 최종 확인

- [ ] 재방문율 계산 방식 검증
- [ ] 전환율 정의 합의 (장바구니 vs 구매)
- [ ] 코호트 기간 구분 승인
- [ ] 서비스별 차별화 지표 검토

### 2단계: 누락 데이터 수집 계획

- [ ] 매출 금액 정보 수집 방안
- [ ] 장바구니 삭제/수정 이벤트 추가
- [ ] 마케팅 캠페인 추적 코드 삽입

### 3단계: 대시보드 구성

- [ ] 우선순위별 대시보드 레이아웃 설계
- [ ] 알림 임계값 설정
- [ ] Grafana 패널 구성

### 4단계: 개인정보 보호 검토

- [ ] userKey 익명화 필요성 검토
- [ ] 데이터 보관 기간 정책 수립
- [ ] 접근 권한 관리 방안

---

## 📞 문의 및 피드백

이 문서에 대한 질문이나 수정 요청은 데이터 플랫폼 팀으로 연락 주세요.

**검토 기한**: 2025-11-06 (1주일)  
**최종 업데이트**: 2025-10-30
