요청하신 유튜브(https://www.youtube.com/watch?v=4sJd6PIkP_s) 영상의 내용을 추출하여 요약해 드립니다.

토스ㅣSLASH 23 - 고객 불안을 0으로 만드는 토스의 Istio Zero Trust
채널: 토스

발표자: 성준영, 한경수 (데브옵스 엔지니어)

이 영상은 토스가 금융 서비스의 핵심인 보안과 안전을 위해 '제로 트러스트(Zero Trust)' 보안 모델을 '이스티오(Istio)' 라는 도구를 사용해 어떻게 구현했는지 설명하는 기술 발표입니다.

주요 내용 요약
크게 2부로 나뉘어 클러스터 내부 통신과 외부 통신에서의 제로 트러스트 구현 방법을 다룹니다.

1부: 클러스터 내부 (마이크로 서비스 간 통신)
발표자 성준영 님은 쿠버네티스 클러스터 내부의 마이크로 서비스 간 통신에 제로 트러스트를 적용한 과정을 설명합니다.

제로 트러스트(Zero Trust)란?

'아무도 신뢰하지 않는다'는 원칙입니다. [00:32] 신뢰할 수 있는 내부망에 있더라도 모든 요청은 올바른 권한을 가졌는지 검증해야 한다는 핵심 원칙입니다. [00:45]

핵심 기술: mTLS와 Istio

mTLS (Mutual TLS): 일반적인 TLS가 클라이언트가 서버만 인증하는 것과 달리, mTLS는 클라이언트와 서버가 '상호' 인증서를 검증합니다. [02:04] 이를 통해 인증된 대상 간의 통신만 허용하고 모든 트래픽을 암호화합니다.

Istio (이스티오): 마이크로 서비스 간의 통신을 도와주는 '서비스 메쉬' 도구입니다. [02:42] Istio를 사용해 복잡한 mTLS 적용과 접근 정책(누가 누구에게 요청할 수 있는지)을 쉽게 관리합니다.

적용 방식:

클라이언트 사이드 제어 (Outbound): Sidecar 리소스를 사용해, 서비스가 호출할 수 있는 다른 서비스의 목록을 사전에 정의합니다. [06:37] 기본적으로는 아무 곳도 호출할 수 없으며, 필요한 서비스만 명시적으로 허용합니다. [07:14]

서버 사이드 제어 (Inbound): AuthorizationPolicy 리소스를 사용해, 돈이 오가는 중요한 서비스의 경우 서버 측에서 특정 API 경로(e.g., /send-money)나 HTTP 메서드(e.g., POST)별로 호출을 제한합니다. [09:09]

관리: 이 복잡한 설정들은 'GitOps'(Argo CD) 기반의 자동화된 파이프라인을 통해 관리하여 개발자가 쉽게 적용할 수 있도록 추상화했습니다. [11:27]

2부: 클러스터 외부 (외부망 및 계열사 간 통신)
발표자 한경수 님은 클러스터 외부에서 들어오는 트래픽(개발자, 계열사, 외부 기관)에 제로 트러스트를 적용한 방법을 설명합니다.

다양한 트래픽 분리:

내부망 트래픽(개발자용), 계열사(토스뱅크, 토스증권) 트래픽, 마이데이터(외부 금융사) 트래픽, 사용자 API 트래픽을 모두 별도의 게이트웨이로 분리하여 관리합니다. [15:24]

계열사 및 마이데이터 통신:

토스뱅크, 토스증권 등 모든 계열사 간의 통신은 100% mTLS를 강제하여 상호 신뢰된 통신만 허용합니다. [19:15]

금융 규제상 필수인 마이데이터 외부 기관과의 통신 역시 mTLS로 구성합니다. [21:40]

해결한 기술적 과제:

클라이언트 IP 유실 문제: mTLS 통신은 암호화되어 있어 L7 프록시 장비가 요청자의 IP를 볼 수 없었습니다. 이는 **'프록시 프로토콜(Proxy Protocol)'**을 사용해 암호화 전 IP 정보를 전달하여 해결했습니다. [25:17]

트래픽 불균형 문제: 액티브-액티브 이중화 클러스터 간 트래픽이 불균형하게 쏠리는 현상은 **'GSLB(Global Server Load Balancing)'**에 DNS 제어를 위임하여 해결했습니다. [26:03]

안정적인 커넥션 종료: 클러스터 점검 시 트래픽을 안전하게 다른 클러스터로 이전시키기 위해, **'EnvoyFilter'**를 사용해 커넥션 최대 유지 시간(max_connection_duration)을 설정하여 클라이언트가 자연스럽게 재연결하도록 유도했습니다. [27:14]